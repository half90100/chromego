/*! 2014-12-19 11:12:26 */
KISSY.add("haitaoAddressNewDialog",function(a,b,c,d,e,f,g,h){function i(a,b,c){var d=this;i.superclass.constructor.apply(d),d.set("html",a),d.set("addrList",b),d.set("selectedID",c),d.init()}return a.extend(i,b,{init:function(){var a=this,b=a.get("className");return KISSY.one("."+b)?null:(a._formateData(),a._initDialog(),a._initSelCompany(),a._setJudgeText(),a._initSelectedIndex(),void a._bindEvents())},_bindEvents:function(){var b=this,c=b.get("dialog"),d=b.get("className"),e=b.get("selCompany"),f=b.get("registerLink");e.on("click",function(a){var c=a.target.get("value");b._setJudgeText(c)}),a.one("."+d).delegate("click",".haitao_judge_yes",function(b){b.preventDefault();var c=a.one("."+d);c.one(".haitao_transaddr_judgewrap").hide(),c.one(".haitao_transaddr_usercodewrap").show();var g=c.one(".haitao_transaddr_selwrap .haitao-select  .haitao-select-content").text();c.one(".haitao_transaddr_selwrap .haitao-select").remove(),c.one(".haitao_transaddr_selwrap span").html('请您<a target="_blank" href="'+f[e.get("content")]+'">登录</a>后，将任意仓库的以下信息拷贝到这里'),a.all("<strong>"+g+"</strong>").insertBefore(c.one(".haitao_transaddr_selwrap span"))}),a.one("."+d).delegate("click",".haitao_transaddr_usercodewrap .submit",function(b){b.preventDefault();var f=a.one("."+d).one(".haitao_transaddr_usercodewrap"),g={fn:f.one("#fn").val(),ln:f.one("#ln").val(),ap:f.one("#ap").val(),comp_id:e.get("value"),_tb_token_:window.Ali_Haitao.login._tb_token_||""},h=RUNTIME_MODE===RUNTIME_MODE_DEV?"./data.json":"http://haiwai.etao.com/ajax/transfer_user_info_inter.htm";KISSY.io.get(h,g,function(a){a&&0==a.resultCode,c.hide()},"json")})},_initDialog:function(){var a=this,b=a.get("html"),c=a.get("dialog"),d=a.get("className"),e=a.get("dialogConfig"),h=a.get("templateData"),i={width:430,elCls:"haitao_dialog haitao_font "+d,mask:!1,headerContent:"设置转运地址",bodyContent:g.to_html(b,h)};i=KISSY.merge(e,i),c=new f.Dialog(i),c.show(),c.on("hide",function(){c.destroy()}),a.set("dialog",c)},_setJudgeText:function(b){var c=this,d=c.get("className"),e=c.get("templateData"),f=c.get("registerLink"),g=c.get("helpLink");b=b||c.get("selectedID");for(var h=e.addrList.length-1;h>=0&&e.addrList[h].id!=b;h--);h=h>=0?h:0;var i=a.one("."+d),j=i.one(".haitao_transaddr_usercodewrap"),k=e.addrList[h];i.one(".haitao_transaddr_judgewrap .haitao_judge_yes").text("已有"+k.name+"账号"),i.one(".haitao_transaddr_judgewrap .haitao_judge_no").text("注册"+k.name+"账号"),i.one(".haitao_transaddr_judgewrap .haitao_judge_no").attr("href",f[k.name]),i.one(".haitao_transaddr_usercodewrap .haitao_transaddr_formaction a").attr("href",g[k.name]),j.one("#fn").val(k.fn),j.one("#ln").val(k.ln),"友家速递"==k.name||"海淘客"==k.name||"递四方"==k.name?(j.one("#ap").val(""),j.one("#ap").parent(".haitao_transaddr_formcontrol").hide()):(j.one("#ap").val(k.ap),j.one("#ap").parent(".haitao_transaddr_formcontrol").show())},_formateData:function(){var b=this,c=b.get("addrList"),d=b.get("templateData");d={},d.addrList=[],a.each(c,function(a){d.addrList.push({id:a.id,name:a.name,fn:a.list[0].firstName,ln:a.list[0].lastName,ap:a.list[0].address2})}),d.isNew=!0,b.set("templateData",d)},_initSelCompany:function(){var a,b=this,c=b.get("selConfig");a=h.Select.decorate("#haitao_sel_transComp",c),b.set("selCompany",a)},_initSelectedIndex:function(){var a,b=this,c=b.get("selCompany"),d=b.get("selectedID"),e=b.get("templateData");for(a=e.addrList.length-1;a>=0&&e.addrList[a].id!==d;a--);c.set("selectedIndex",a>=0?a:0)}},{ATTRS:{dialogConfig:{value:{draggable:!0,elCls:"haitao_dialog haitao_font ",prefixCls:"haitao-ks-",headerContent:"提示",bodyContent:'<div class="haitao_empty_div"></div>',mask:!1,closeAction:"destroy",align:{overflow:{adjustX:1,adjustY:1},offset:[0,300],points:["tc","cc"]},aria:!0}},selConfig:{value:{prefixCls:"haitao-",width:100,menuAlign:{offset:[0,-1]},menuCfg:{width:100}}},dialog:{value:null},className:{value:"haitao_dialog_address"},registerLink:{value:{"友家速递":"http://www.youjiaus.net/","百通":"http://www.buytong.cn/IndexNew.aspx?region=usa","递四方":"http://tr.4px.com/","斑马物流":"http://www.360zebra.com/Default.aspx"}},helpLink:{value:{"友家速递":"http://wanke.etao.com/detail/343013.html","百通":"http://wanke.etao.com/detail/343016.html","递四方":"http://wanke.etao.com/detail/343014.html","斑马物流":"http://wanke.etao.com/detail/343019.html"}},templateData:{value:{addrList:[]}},selCompany:{value:null}}}),i},{requires:["base","node","event","io","overlay","mu","menubutton","haitaoUtils"]});