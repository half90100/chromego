/*! 2014-12-19 11:12:26 */
KISSY.add("haitaoAddrSmartSelect",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){var d=this;j.superclass.constructor.call(d),c=c?c:"",d.set("shipCompData",a),d.set("callback",b),d.set("prefix",c),d.init()}return a.extend(j,b,{init:function(){var a=this;a._setPriority(),a._initSelCompany(),a._bindEvents()},_bindEvents:function(){var b=this,c=0,d=1,e=2,f=c,g=(b.get("selChannel"),b.get("selCompany")),j=b.get("shipCompData"),k=a.one(document);k.undelegate("mouseenter",".haitao-option .extra"),k.delegate("mouseenter",".haitao-option .extra",function(c){a.one(c.currentTarget).hasClass("opt")?(b._resetEditInfo(),a.one(c.currentTarget).text("修改"),f=e):f=d}),k.undelegate("mouseleave",".haitao-option .extra"),k.delegate("mouseleave",".haitao-option .extra",function(){b._resetEditInfo(),f=c}),k.delegate("click",".haitao_sel_transComp",function(){b._resetEditInfo()}),g.on("click",function(g){var k=g.target.get("value");if(f===d)new h(window.Ali_Haitao.template.transaddress,j,k),b._removeSelChannel(),a.one(".haitao_sel_transComp .haitao-select-content").text("选择转运"),a.one("#haitao_shipAddrTips_1 .haitao_sel_transChannel").hide(),b._resetSelChannel();else if(f===e){var l=b.get("addressEditDialog");l&&l.destroy(),l=new i(window.Ali_Haitao.template.transaddress,j,k),b.set("addressEditDialog",l),b._removeSelChannel(),a.one(".haitao_sel_transComp .haitao-select-content").text("选择转运"),a.one("#haitao_shipAddrTips_1 .haitao_sel_transChannel").hide(),b._resetSelChannel()}else a.one(".haitao_sel_transComp .haitao-select-content").text(a.all(g.target.get("content")).filter(".name").text()),b.set("curShipCompId",k),b._update(k);b._resetEditInfo(),f=c},b)},_resetSelChannel:function(){var a=this,b=a.get("selChannel");b&&b.get("el").remove(),a.set("selChannel",null)},_resetEditInfo:function(){a.all(".haitao-option .extra").each(function(b){var b=a.one(b);b.hasClass("opt")&&b.text("已保存")})},_initSelCompany:function(){var a=this,b=a.get("shipcompObj"),c=a.get("shipCompData"),d=new e.Select({prefixCls:"haitao-",width:100,defaultCaption:"选择转运",matchElWidth:!1,render:".haitao_sel_transComp",menu:{width:120,offset:[0,-1]}});a.set("selCompany",d);for(var f=0;f<c.length;f++){b[c[f].id]=c[f];var g='<span class="name">'+c[f].name+"</span>";"海淘客"==c[f].name?g+='<span class="extra">推荐</span>':c[f].isSet&&(g+='<span class="extra opt">已保存</span>'),d.addItem(new e.Option({value:c[f].id,prefixCls:"haitao-",content:g}))}a.set("shipcompObj",b),d.render()},_removeSelChannel:function(){var a=this,b=a.get("selChannel"),c=a.get("curShipCompId"),d=a.get("shipChannelObj");b||(b=new e.Select({prefixCls:"haitao-",width:130,defaultCaption:"&nbsp;",render:".haitao_sel_transChannel",menu:{width:130,offset:[0,-1]}}),b.render(),b.on("click",function(b){var e=b.target.get("value"),f=a.get("callback");if(f){var g=d[e];g.province=g.province.toUpperCase().substr(0,2),g.transId=c,f(g)}}),a.set("selChannel",b)),b&&b.removeItems(!0),a.set("shipChannelObj",{})},_update:function(b){var c=this,d=c.get("shipCompData"),f=c.get("shipcompObj"),g=c.get("selChannel"),h=c.get("shipChannelObj");b||(b=d[0].id);var i=f[b];c._removeSelChannel(),g||(g=c.get("selChannel")),a.one("#haitao_shipAddrTips_1 .haitao_sel_transChannel").show(),a.each(i.list,function(a){h[a.wareHouseNo]=a,g.addItem(new e.Option({value:a.wareHouseNo,prefixCls:"haitao-",content:a.wareHouseName}))}),g.set("value",i.list[0].wareHouseNo),g.fire("click"),c.set("shipChannelObj",h)},_setPriority:function(){for(var a=this,b=a.get("shipCompData"),c=b,d=null,e=0;e<c.length;e++)if("海淘客"==c[e].name){d=c[e],c.splice(e,1);break}null!=d&&c.unshift(d),a.set("shipCompData",c)}},{ATTRS:{curShipCompId:{value:""},shipcompObj:{value:{}},shipChannelObj:{value:{}},selChannel:{value:null},selCompany:{value:null}}}),j},{requires:["base","node","event","menubutton","mu","overlay","haitaoAddressNewDialog","haitaoAddressEditDialog"]});