/*! 2014-12-19 11:12:26 */
KISSY.add("haitaoShipCompareDialog",function(a,b,c,d,e,f,g,h){function i(a){var b=this;i.superclass.constructor.apply(b),b.set("weight",a),b.init()}var j=new e;return a.extend(i,b,{init:function(){var a=this;a._initDialog(),a.initWeightInput(),a.initHoverTip(),a._bindEvents(),KISSY.one(".haitao_dialog_shipCompare").one(".haitao_update_weight").getDOMNode().focus(),KISSY.one(".haitao_dialog_shipCompare").one(".haitao_update_weight").fire("blur"),setTimeout(function(){KISSY.one(".haitao_dialog_shipCompare").one(".haitao_update_weight").getDOMNode().focus()},100)},_bindEvents:function(){var b=a.one(".haitao_dialog_shipCompare");b.delegate("mouseenter","#haitao_shipCompare_wrapper #haitao_shipCompare_detail tr",function(b){b.preventDefault();var c=a.one(b.currentTarget);c.hasClass("empty_tr")||c.addClass("hover")}),b.delegate("mouseleave","#haitao_shipCompare_wrapper #haitao_shipCompare_detail tr",function(b){b.preventDefault();var c=a.one(b.currentTarget);c.hasClass("empty_tr")||c.removeClass("hover")}),b.delegate("click","#haitao_shipCompare_wrapper #haitao_shipCompare_detail tr",function(b){b.preventDefault();var c=a.one(b.currentTarget);if(!c.hasClass("empty_tr")){var d=c.attr("data-id"),e=parseInt(d.slice(d.length-1,d.length)),f=d.slice(0,d.length-1);a.one("body").fire("EV_COMPANYCHANEL_SYNC",{company:f,channel:e})}})},_initDialog:function(){var a=this,b=a.get("weight"),c={draggable:!0,elCls:"haitao_dialog haitao_font ",prefixCls:"haitao-ks-",headerContent:"提示",bodyContent:'<div class="haitao_empty_div"></div>',mask:!1,closeAction:"destroy",align:{overflow:{adjustX:1,adjustY:1},offset:[0,0],points:["cc","cc"]},aria:!0},d=window.Ali_Haitao.shipCompareDialog;if(d&&d.destroy&&(d.destroy(),d=null),window.Ali_Haitao.template&&window.Ali_Haitao.template.shipCompare){var e="haitao_dialog_shipCompare";if(KISSY.one("."+e))return null;var f=KISSY.one(window).height()-40,g=500,i=400,j=g;g>f&&(j=f),i>f&&(j=i);var k={width:730,height:j,elCls:"haitao_dialog haitao_font "+e,mask:!1,bodyContent:a.generateHtml(b)};k=KISSY.merge(c,k),d=new h.Dialog(k),d.show(),KISSY.one("#haitao_shipCompare_detail").height(j-85),window.Ali_Haitao.shipCompareDialog=d,a.set("calDialogHeight",j)}},initWeightInput:function(){var a=this,b=a.get("calDialogHeight"),c="haitao_dialog_shipCompare";new f("."+c+" .haitao_update_weight",function(c){var d=KISSY.one("#haitao_single_price").one(".haitao_update_weight"),e=KISSY.one(".haitao_dialog_shipCompare").one(".haitao_update_weight");c="0"==e.val()?d.val():e.val(),d.val(c),d.getDOMNode().focus(),d.fire("blur"),setTimeout(function(){KISSY.one(".haitao_dialog_shipCompare .haitao-ks-dialog-body").html(a.generateHtml(c)),KISSY.one("#haitao_shipCompare_detail").height(b-85),a.initHoverTip(),a._bindEvents()},50)})},generateHtml:function(a){var b=this;return g.to_html(window.Ali_Haitao.template.shipCompare,b.generateData(a))},generateData:function(a){var b=window.Ali_Haitao.template.shipping,c=window.Ali_Haitao.transTimeStat,d="object"==typeof b?KISSY.clone(b):JSON.parse(b),e="object"==typeof c?KISSY.clone(c):JSON.parse(c),f=[];for(var g in d.shipCompany){var h=d.shipCompany[g];if("haitaoke"!=h.id)for(var i=0;i<h.lines.length;i++)h.lines[i].isHaitaoke="haitaoke"==h.id?!0:!1,h.lines[i].isYoujia="youjia"==h.id?!0:!1,h.lines[i].isDisifang="disifang"==h.id?!0:!1,h.lines[i].isFirst=0==i?!0:!1,h.lines[i].compName=h.name,h.lines[i].compId=h.id,h.lines[i].transTimeStat=e[h.id],f.push(h.lines[i])}for(var k=0;k<f.length;k++)f[k].shippingCompanyPrice=j.getShippingPrice({shippingWeight:a},f[k]).shippingCompanyPrice,f[k].moneyUnit="1"==f[k].exchangeRate?"￥":"$";return{weight:a,shipList:f}},initHoverTip:function(){for(var a=[],b=KISSY.all("#haitao_shipCompare_wrapper .haitao_si_item"),c=0;c<b.length;c++)a.push({trigger:b[c],srcNode:b[c].nextElementSibling});for(var d=0;d<a.length;d++){var e=a[d];new h.Popup({srcNode:e.srcNode,trigger:e.trigger,triggerType:"mouse",align:{node:e.trigger,points:["bc","tc"],offset:[-2,10]}})}}},{ATTS:{weight:{value:void 0},calDialogHeight:{value:void 0}}}),i},{requires:["base","node","event","haitaoTransShip","haitaoWeightInput","mu","overlay","dd"]});