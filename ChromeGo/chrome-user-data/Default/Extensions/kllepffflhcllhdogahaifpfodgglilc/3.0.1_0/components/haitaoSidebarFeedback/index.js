/*! 2014-12-19 11:12:26 */
KISSY.add("haitaoSidebarFeedback",function(a,b,c,d,e,f,g){function h(){h.superclass.constructor.call(this),this.init()}return a.extend(h,b,{init:function(){var a=this;a._initSelect(),a._bindEvents()},_bindEvents:function(){var b=this,c=a.one(b.get("idSelector")),d=b.get("select"),e=c.one(".bd").one("form.info"),f="@@@@";e.delegate("click",".reset",function(a){a.preventDefault(),d.set("selectedIndex",0),e.one("#trans_num").val(""),e.one("#description").val(""),e.one("#email").val("")}),e.delegate("click",".submit",function(d){d.preventDefault();var h={sourceid:116,surveyid:116,causes:e.one('input[name="trans_company"]').val(),sfrom:"etao_feedback",nk:a.Cookie.get("_nk_")||"",fromurl:document.domain},i=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;return i.test(e.one("#email").val())?(h.content="Email: "+e.one("#email").val()+f+"DESCRIPTION: "+e.one("#description").val()+f+"TRANSNUM: "+e.one("#trans_num").val(),g.jsonp("http://search.feedback.taobao.com/talkers/add_feedback.php",h,function(a){a&&1==a.status}),e.one("#email").siblings(".warn").hide(),c.one(".info").one(".btns").one(".tip").hide(),c.one(".info").one(".btns").one(".success").show(),void a.later(function(){c.hide(),c.one(".info").one(".btns").one(".tip").show(),c.one(".info").one(".btns").one(".success").hide(),b.destroy()},2e3)):void e.one("#email").siblings(".warn").show()}),c.delegate("click",".haitao-ks-dialog-close",function(a){a.preventDefault(),c.hide(),b.destroy()})},_initSelect:function(){var a=this,b=a.get("select");b||(b=e.Select.decorate("#trans_company",{width:170,height:28,prefixCls:"haitao-",menuAlign:{offset:[0,0]},menuCfg:{width:159,align:{offset:[0,0]},elStyle:{overflow:"auto",overflowX:"hidden",color:"#999999",fontSize:"13px"}}}),a.set("select",b))},_destroy:function(){var b=this,c=a.one(b.get("idSelector")),d=c.one(".bd").one("form.info");d.undelegate("click",".reset"),d.undelegate("click",".submit"),d.undelegate("click",".haitao-ks-dialog-close")}},{ATTRS:{select:{value:null},idSelector:{value:"#haitao_feedback_dialog"}}}),h},{requires:["base","node","event","menubutton","cookie","io"]});