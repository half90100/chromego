/*! 2014-12-19 11:12:26 */
var allowWebSite=["amazon.com","asos.com","us.asos.com","nordstrom.com","walgreens.com","bhphotovideo.com","6pm.com","secure-www.6pm.com","drugstore.com","rei.com","iherb.com","secure.iherb.com","saksfifthavenue.com","net-a-porter.com","gnc.com","gymboree.com","diapers.com","puritan.com","albeebaby.com","us-dc2-order.store.yahoo.net","order.store.yahoo.net","rakuten.com","overstock.com","bluefly.com","karmaloop.com","meijer.com","toysrus.com","zappos.com","neimanmarcus.com","footlocker.com","luckyvitamin.com","beauty.com","forwardforward.com","ulta.com","skinstore.com","beautybar.com","ralphlauren.com","sephora.com","us.burberry.com","lushusa.com","victoriassecret.com","store.diesel.com","bodybuilding.com","lordandtaylor.com","bcbg.com","jcrew.com","aeropostale.com","gucci.com","adidas.com","swarovski.com","stevemadden.com","dkny.com","express.com","ae.com","nautica.com","usa.hermes.com","katespade.com","jcpenney.com","marcjacobs.com","toms.com","lancome-usa.com","jbrandjeans.com","usa.loccitane.com","paulfrank.com","wildfoxcouture.com","kennethcole.com","kswiss.com","us.levi.com","beautive.com","forever21.com","ninewest.com","bestbuy.com","elizabetharden.com","clinique.com","esteelauder.com","bobbibrowncosmetics.com","vitaminworld.com","easyspirit.com","h2oplus.com","crabtree-evelyn.com","uggaustralia.com","alexanderwang.com","oldnavy.gap.com","newegg.com","bananarepublic.gap.com","walmart.com","sierratradingpost.com","dsw.com","backcountry.com","shopbop.com","vitacost.com"],transTimeInitData={youjia:{t2t1:{avg:3,min:2,max:5},t3t2:{avg:3,min:2,max:5},t4t3:{avg:20,min:10,max:30},t4t1:{avg:26,min:14,max:40}},disifang:{t2t1:{avg:3,min:2,max:5},t3t2:{avg:3,min:2,max:5},t4t3:{avg:18,min:14,max:20},t4t1:{avg:24,min:18,max:30}},baitong:{t2t1:{avg:3,min:2,max:5},t3t2:{avg:7,min:5,max:12},t4t3:{avg:30,min:20,max:90},t4t1:{avg:40,min:27,max:107}},banma:{t2t1:{avg:3,min:2,max:5},t3t2:{avg:3,min:2,max:5},t4t3:{avg:22,min:20,max:25},t4t1:{avg:28,min:24,max:35}},haitaoke:{t2t1:{avg:3,min:1,max:5},t3t2:{avg:1,min:2,max:2},t4t3:{avg:18,min:12,max:14},t4t1:{avg:18,min:14,max:25}}};window.Ali_Haitao={debug:!1,login:{},config:{},sizeDialog:null,priceCompareDialog:null,defaultShip:{},shipping:{},mmstat_cna:"null",shippingList:[],currentRate:6.1234,template:{priceDetail:'<div class="haitao_tips haitao_tips_permanent haitao_tips_price haitao_font haitao_triangle haitao_triangle_{{website}} haitao_tips {{triangle}}" style="left:{{left}}px;top:{{top}}px;"><div class="haitao_tips_title"><span class="haitao_tips_left">到手价约<span class="haitao_yellow">￥{{price}}</span></span><span class="haitao_tips_right">明细<em></em></span></div>',sizeTips2:'<div id="{{id}}" class="haitao_font haitao_tips haitao_triangle haitao_triangle_{{website}} {{triangle}} {{foldStatus}}" style="left:{{left}}px; top:{{top}}px;"><div class="haitao_tips_title"><a href="javascript:void(0);" class="haitao_tips_center haitao_size_convert"><i></i>{{text}}</a></div></div>',sizeTips:'<div id="{{id}}" class="haitao_font haitao_tips haitao_triangle haitao_triangle_{{website}} {{triangle}} {{foldStatus}}" style="left:{{left}}px; top:{{top}}px;"><div class="haitao_tips_title haitao_size_convert haitao-stat" data-stat="web.size.size"><span class="haitao_tips_left"><i></i>{{text}}</span><span class="haitao_tips_right">l<em></em></span></div></div>',otherTips:'<div id="{{id}}" class="haitao_font haitao_tips haitao_tips_option haitao_triangle haitao_triangle_{{website}} {{triangle}} {{class}}" style="{{posAlign}}:{{left}}px; top:{{top}}px;{{style}}"><div class="haitao_tips_title"><span class="haitao_tips_center"><i></i>{{text}}<span class="haitao_font haitao_yellow {{haitao_sbTip}}">{{textHtml}}</span>{{aftertext}}</span></div></div>',shipAddrNotLoginTips:'<div id="{{id}}" class="haitao_font haitao_tips haitao_tips_option haitao_triangle haitao_triangle_{{website}} {{triangle}}" style="{{posAlign}}:{{left}}px; top:{{top}}px;{{style}};"><div class="haitao_tips_title haitao-stat" data-stat="web.address.signin"><span class="haitao_tips_center"><i></i>{{text}}<span class="haitao_font haitao_yellow">{{textHtml}}</span>{{aftertext}}</span></div></div>',shipAddrTips:'<div id="{{id}}" class="haitao_font haitao_triangle haitao_triangle_{{website}} haitao_tips {{triangle}}" style="{{posAlign}}:{{left}}px; top:{{top}}px;{{style}}"><div class="haitao_tips_title"><span class="haitao_tips_center"><i></i>{{text}}<div class="haitao_sel_transComp"></div><div class="haitao_sel_transChannel"></div></span></div></div>',shipAddrTipsOld:'<div id="{{id}}" class="haitao_font haitao_triangle haitao_triangle_{{website}} haitao_tips {{triangle}}" style="{{posAlign}}:{{left}}px; top:{{top}}px;{{style}}"><div class="haitao_tips_title"><span class="haitao_tips_center"><i></i>{{text}}<select id="{{haitao_shipAddr_sel}}" class="haitao_sel">{{#addrList}}<option value="{{optionid}}">{{wareHouseName}}</option>{{/addrList}}</select></span></div></div>'},isTranslate:"true",isShowTips:"true",isShowPushNotify:"true",isLoadTips:"false",shipAddress:null},KISSY.add("haitaoUtils",function(a,b,c,d,e,f,g){return HaitaoUtils={popupLogin:function(){window.open("http://www.etao.com/go/rgn/haitaoshenqilogin.php","etao_login window","height=364,width=344,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no,titlebar=no")},checkIsLogin:function(){var a=window.Ali_Haitao.login;return a&&a.login&&"true"==a.login?!0:!1},listenCssChange:function(a,b){var c=null,d=KISSY.all(a);if(d)for(var e=0;e<d.length;e++)new g(d[e],function(){c&&clearTimeout(c),c=setTimeout(function(){console.log("listenCssChange execute"),KISSY.one("body").fire("haitaoRepaint"),b&&b(),c=null},100)})},placeOrder:function(a){KISSY.isArray(a)?KISSY.each(a,function(a){HaitaoUtils.bindSubmitFunction(a)}):HaitaoUtils.bindSubmitFunction(a)},bindSubmitFunction:function(b){a.one(document).delegate("click",b.orderButton,function(){"pay"==b.type&&HaitaoUtils.getMessageFromBackground({operate:"submitOrder",data:{name:getMatchedWebSiteDomain()}},function(){});var a="cache=16f63b4&gmkey=etao_search&gokey=sfrom=etao&t=1369194202558&&cna="+(window.Ali_Haitao.mmstat_cna?window.Ali_Haitao.mmstat_cna:"null")+"&isbeta=7&logtype=2&click=etao.etao_haitao_addin.{{browser}}",c=0,d=KISSY.one(b.priceQuery);d&&(c=HaitaoUtils.calDollarPrice(d.text()));var e="web.order.place&"+b.type+"={{browser}}:"+c+";sell:"+getMatchedWebSiteDomain()+("cart"==b.type?HaitaoUtils.amazonCartPlaceOrderStat():HaitaoUtils.amazonPayPlaceOrderStat());KISSY.Stat(a+e,!0)})},amazonPayPlaceOrderStat:function(){var a="";if("amazon"==getMatchedWebSiteDomain())for(var b=KISSY.all("input[name=dupOrderCheckArgs]"),c=0;c<b.length&&7>c;c++){var d=b[c],e=d.value.split("|"),f=e[0],g=localStorage["ali_weight_"+f]?localStorage["ali_weight_"+f]:"0",h="0";try{h=KISSY.one(d).parent().one(".a-color-price")[0].innerText.replace("$","")}catch(i){}a+=";auction"+c+":"+KISSY.trim(f)+"_"+KISSY.trim(h)+"_"+KISSY.trim(g)+"_"+KISSY.trim(e[1])}return a},amazonCartPlaceOrderStat:function(){var a="";if("amazon"==getMatchedWebSiteDomain())for(var b=KISSY.all("#cart-active-items .item-list .cart-item"),c=0;c<b.length&&7>c;c++){var d=b.item(c),e=d.attr("asin")||"",f=d.attr("price").replace("$","")||0,g=d.attr("quantity")||0,h=localStorage["ali_weight_"+e]?localStorage["ali_weight_"+e]:"0";a+=";auction"+c+":"+KISSY.trim(e)+"_"+KISSY.trim(f)+"_"+KISSY.trim(h)+"_"+KISSY.trim(g)}return a},showBrowserAddrNotify:function(){var a=window.Ali_Haitao.config;if(a&&a.website){var b=getMatchedWebSiteDomain();if("null"==b)return;if(a.website[b])return}var c=localStorage.neverShowBrowserAddrNotify;c&&"true"==c||HaitaoUtils.getMessageFromBackground({operate:"showAddrNotify",data:""},function(){})},neverRemindAddrNotify:function(){localStorage.neverShowBrowserAddrNotify="true"},shipAddressTips:function(a){var b="haitao_shipAddrTips_1",c=KISSY.one("#"+b);c&&c.remove();var d=null;if(KISSY.isArray(a)){for(var e=0;e<a.length;e++)if(KISSY.one(a[e].query)&&HaitaoUtils.isVisible(KISSY.one(a[e].query))){d=a[e];break}}else d=a;if(null!=d){var f=KISSY.one(d.query);if(f&&HaitaoUtils.isVisible(f))if(HaitaoUtils.checkIsLogin()){var g=KISSY.one(".etaologin-overlay .J_CloseLoginBtn");g&&g.fire("click")}else{var h=HaitaoUtils.getAbsolutePos(f,d.x,d.y);HaitaoUtils.generateTemplateHtml(window.Ali_Haitao.template.shipAddrNotLoginTips,{triangle:d.triangle,left:h.left,top:h.top,style:d.style||"",posAlign:"left",id:b,text:"[登录] 支付宝，海淘神器帮你填转运地址!"},function(a){var c=KISSY.one("#"+b);c&&c.remove(),KISSY.one("body").append(a),KISSY.one("#"+b).on("click",function(){HaitaoUtils.popupLogin()})})}}},generateAutoAddrList:function(a,b,c){var e="haitao_shipAddrTips_1",f=null;if(KISSY.isArray(b)){for(var g=0;g<b.length;g++)if(KISSY.one(b[g].query)&&HaitaoUtils.isVisible(KISSY.one(b[g].query))){f=b[g];break}}else f=b;if(null!=f){var h=KISSY.one(f.query);if(h&&HaitaoUtils.isVisible(h)){var i=window.Ali_Haitao.login;i&&i.login&&"true"==i.login&&KISSY.use("haitaoAddrSmartSelect",function(b,g){var i=KISSY.one("#"+e);i&&i.remove();var j=HaitaoUtils.getAbsolutePos(h,f.x,f.y),k={triangle:f.triangle,left:j.left,top:j.top,posAlign:"left",style:f.style||"",id:e,text:"海淘神器帮你填转运地址",haitao_shipAddr_sel:"haitao_shipAddr_sel"};k.website=getMatchedWebSiteDomain();var l=d.to_html(window.Ali_Haitao.template.shipAddrTips,k);KISSY.one("body").append(l),new g(a,function(a){if(!a.empty||"true"!=a.empty){var b=f.addressMap;if(b){for(var d in b){var e=KISSY.one(b[d]);e&&e.val("fullName"==d?a.firstName+" "+a.lastName:"fullAddress"==d?a.address1+" "+a.address2:"fullZipCode"==d?a.zipCode:"zipCode"==d?a.zipCode.split("-")[0]:"zipCodeLast"==d?a.zipCode.split("-")[1]||"":"province"==d?c?c[a[d]]:a[d]:"address2"==d&&"2088301345047652"==a.transId?"":a[d])}KISSY.one("body").fire("haitao_auto_address")}}})})}}},calDollarPrice:function(a){a=a.replace(/(^\s*)|(\s*$)/g,"");var b=0;return b=-1!=a.indexOf("$")?a.replace(/[^0-9.]/g,""):-1!=a.indexOf("￥")||-1!=a.indexOf("¥")?a.replace(/[^0-9.]/g,"")/HaitaoUtils.getCurrentRate():a.replace(/[^0-9.]/g,""),isNaN(b)&&(b=0),parseInt(100*b)/100},calChinaPrice:function(a){a=a.replace(/(^\s*)|(\s*$)/g,"");var b=0;return-1!=a.indexOf("$")?b=a.replace(/[^0-9.]/g,"")*HaitaoUtils.getCurrentRate():(-1!=a.indexOf("￥")||-1!=a.indexOf("¥"))&&(b=a.replace(/[^0-9.]/g,"")),isNaN(b)&&(b=0),parseInt(100*b)/100},generatePriceWithoutWeight:function(a,b){var c="haitao_detailPrice_tip",d=KISSY.one("#"+c);d&&d.remove();var e=HaitaoUtils.calChinaPrice(b);0!=e&&HaitaoUtils.generateTemplateHtml(window.Ali_Haitao.template.otherTips,{triangle:a.triangle,left:a.posLeft,top:a.posTop,posAlign:"left",id:c,style:"",text:"约",textHtml:"￥"+e,aftertext:a.aftertext||"（不含转运费）"},function(a){KISSY.one("body").append(a)})},getMessageFromBackground:function(a,b){chrome.extension.sendMessage(a,function(c){return""==c||void 0==c?void console.log("Get "+a.operate+"Info from background.js error"):void b(c)})},generateTemplateHtml:function(a,b,c){b.website=getMatchedWebSiteDomain(),c(d.to_html(a,b))},setBackgroundLocalStore:function(a){HaitaoUtils.getMessageFromBackground({operate:"setLocalStorage",data:a},function(){})},getLoginStatus:function(){HaitaoUtils.checkWebSite()&&HaitaoUtils.getMessageFromBackground({operate:"getLoginStatus",data:{}},function(a){JSON.stringify(window.Ali_Haitao.login)!=a&&(window.Ali_Haitao.login=JSON.parse(a),KISSY.one("body").fire("haitaoRepaint"))})},getCurrentRate:function(){var b="http://haiwai.etao.com/ajax/exchangeRateList.htm";return e.getJSON(b,function(b){if(b&&!b.resultCode){{b.data}a.each(b.data,function(a){"USD"==a.code&&(localStorage.ali_currentRate=a.rate,localStorage.ali_currentRate_last=(new Date).getTime())})}}),localStorage.ali_currentRate?localStorage.ali_currentRate:window.Ali_Haitao.currentRate},translateCallback:function(a){window.Ali_Haitao.template&&window.Ali_Haitao.template.translate&&a&&(a.direction="left",a.vdirection="top",a.website=getMatchedWebSiteDomain(),a.distance=window.Ali_Haitao.cursorX-30,a.vdistance=window.Ali_Haitao.cursorY+5,KISSY.one(document).width()<2*window.Ali_Haitao.cursorX&&(a.direction="right",a.distance=KISSY.one(document).width()-window.Ali_Haitao.cursorX),KISSY.one(window).height()-(window.Ali_Haitao.cursorY-window.scrollY)<150&&(a.vdirection="bottom",a.vdistance=KISSY.one(window).height()-window.Ali_Haitao.cursorY+5),HaitaoUtils.generateTemplateHtml(window.Ali_Haitao.template.translate,a,function(a){var b=KISSY.all(".haitao_trans_tips");b&&b.remove(),KISSY.one("body").append(a)}))},checkWebSite:function(){return!0},loadExtraResource:function(){var a=window.Ali_Haitao.config,b="";if(a.css)for(var c=a.css,d=0;d<c.length;d++)b+=window.Ali_Haitao.isLoadRemoteRes?'<link rel="stylesheet" href="'+a.extraUrl+c[d]+'"/>':'<link rel="stylesheet" href="'+chrome.extension.getURL(c[d])+'"/>';""!=b.trim()&&(b=b.replace("http:",window.location.protocol),KISSY.one("head").append(b))},getRelativePos:function(a,b,c,d,e,f){var g=KISSY.one(a),h=KISSY.one(b),i=g.offset(),j=h.offset(),k=j.left-i.left,l=j.top-i.top,m=k+h.width(),n=l+h.height();return{left:k+(void 0!=d?d:0),top:l+(void 0!=c?c:0),right:m+(void 0!=e?e:0),bottom:n+(void 0!=f?f:0)}},getAbsolutePos:function(a,b,c){var d=a.offset(),e=a.width(),f=a.height();return{left:d.left+(b?b:0),top:d.top+(c?c:0),right:d.left+e+(b?b:0),bottom:d.top+f+(c?c:0)}},isVisible:function(a){var b=a.offset();return"none"==a.css("display")||"hidden"==a.css("visibility")?!1:b.left>0&&b.top>0&&a.width()>0&&a.height()>0?!0:!1},getShipAddress_bg:function(a,b,c){var d=HaitaoUtils.getShipNameMap(),f=RUNTIME_MODE===RUNTIME_MODE_DEV?"./data.json":"http://haiwai.etao.com/ajax/tranship_addr.htm";e.get(f,function(a){var b="object"==typeof a?a:JSON.parse(a);if(b=RUNTIME_MODE===RUNTIME_MODE_DEV?b.transAddr:b,0==b.resultCode){for(var e=["递四方","友家速递","百通","斑马物流"],f=0;f<b.data.length;f++){var g=b.data[f];if(-1!=e.indexOf(g.name))if("海淘客"!=g.name||g.list[0].firstName&&g.list[0].lastName)for(var h=0;h<g.list.length;h++){var i=g.list[h];d[g.id+"-"+i.wareHouseNo]&&(i.wareHouseName=d[g.id+"-"+i.wareHouseNo])}else b.data.splice(f,1);else b.data.splice(f,1)}chrome.tabs.sendMessage(c.tab.id,{operate:"getShipAddressCallback",data:b.data},function(){})}else 1==b.resultCode&&("获得用户登录信息错误"==b.msg||"系统异常"==b.msg)})},getShipAddress:function(){HaitaoUtils.getMessageFromBackground({operate:"getShipAddress",data:""},function(){})},initTips:function(a){a.size&&HaitaoUtils.sizeTips(a.size),a.others&&HaitaoUtils.otherTips(a.others),a.help&&HaitaoUtils.helpTips(a.help)},sizeTips:function(b){if(b){var c=KISSY.one("#"+b.id),d="";c&&(d=c.hasClass("haitao_unfold")?"haitao_unfold":"",c.remove());var e=KISSY.one(b.query);if(e&&""!=e.html().trim()){var f=KISSY.one(b.posquery),g=f?f:e,h=(g.width()+b.left,b.top,g.parent(b.relquery)?g.parent(b.relquery):g);h.addClass("haitao_relative");var i=HaitaoUtils.getAbsolutePos(g,b.x,b.y);HaitaoUtils.generateTemplateHtml(window.Ali_Haitao.template.sizeTips,{id:b.id,triangle:b.triangle,foldStatus:d,left:b.pos&&"right"==b.pos?i.right:i.left,top:i.top,text:b.text},function(b){function c(){var a=KISSY.one(f);if(a)if(a.hasClass("haitao_unfold")){a.removeClass("haitao_unfold");var b=window.Ali_Haitao.sizeDialog;b&&b.destroy&&(b.destroy(),b=null)}else a.addClass("haitao_unfold"),KISSY.use("haitaoSizeDialog",function(a,b){new b})}function d(a){var b=KISSY.one(f),c=KISSY.one(a.target),d="haitao_dialog_size";if(b){if(e=c.hasClass(d)||c.parent("."+d),c.parent(f)||c.parent(".haitao-menu")||e||c.hasClass("haitao_chima")||c.parent(".haitao_chima"))return;b.removeClass("haitao_unfold");var e=window.Ali_Haitao.sizeDialog;e&&e.destroy&&(e.destroy(),e=null)}}function e(){var a=KISSY.one(f);a&&a.removeClass("haitao_unfold")}a.one("body").append(b);var f="#haitao_size_tip_1",g=a.one(f+" .haitao_tips_title"),h=KISSY.one(document);g.detach("click",c),h.detach("click",d),h.undelegate("click",".haitao-ks-ext-close",e),g.on("click",c),h.on("click",d),h.delegate("click",".haitao-ks-ext-close",e)})}}},otherTips2:function(a){if(a)for(var b=0;b<a.length;b++){var c=a[b];"haitao_others_tips_10"==c.id;var d=KISSY.one("#"+c.id);d&&d.remove();var e=KISSY.one(c.query);if(c.condition&&e&&HaitaoUtils.isVisible(e)||!c.condition&&(!e||!HaitaoUtils.isVisible(e))){var f=KISSY.one(c.posquery)?KISSY.one(c.posquery):e;if(f&&HaitaoUtils.isVisible(f)){var g=HaitaoUtils.getAbsolutePos(f,c.x,c.y);HaitaoUtils.generateTemplateHtml(window.Ali_Haitao.template.otherTips,{triangle:c.triangle,left:c.posAlign&&"right"==c.posAlign?KISSY.one(document).width()-g.left:c.pos&&"right"==c.pos?g.right:g.left,top:g.top,posAlign:c.posAlign||"left",id:c.id,text:c.text,"class":c.class,textHtml:c.textHtml||"",aftertext:c.aftertext||""},function(a){KISSY.one("body").append(a)})}}}},otherTips:function(b){function c(){function a(){var a=KISSY.one("#J_haitao_sbTip");if(!a){var a='<div id="J_haitao_sbTip"><h5>信用卡识别：</h5><div class="content">'+d+"</div><i></i></div>";KISSY.one("body").append(a)}a=KISSY.one("#J_haitao_sbTip"),a.css({left:c.offset().left+11,top:c.offset().top+36}),a.show()}function b(){KISSY.one("#J_haitao_sbTip").hide()}var c=KISSY.one(".haitao_sbTip");if(c){var d="www.amazon.com"==location.host?"<p>单币信用卡：信用卡上只有<em>银联</em>标志。</p><p>双币信用卡：信用卡上有<em>Vista</em>、<em>MasterCard</em>、<em>JCB</em>、<em>AmericanExpress</em>等标志，一般都是双币信用卡。":"<p>双币信用卡：信用卡上有<em>Vista</em>、<em>MasterCard</em>、<em>JCB</em>、<em>AmericanExpress</em>等标志，一般都是双币信用卡。";c.detach("mouseenter",a),c.detach("mouseleave",b),c.on("mouseenter",a),c.on("mouseleave",b)}}function d(a,b,d){if(a.condition&&b&&HaitaoUtils.isVisible(b)||!a.condition&&(!b||!HaitaoUtils.isVisible(b))){var f=KISSY.one(a.posquery)||b;if(f&&HaitaoUtils.isVisible(f)){var g=HaitaoUtils.getAbsolutePos(f,a.x,a.y);id=void 0===d?a.id:a.id+"_"+d,HaitaoUtils.generateTemplateHtml(window.Ali_Haitao.template.otherTips,{triangle:a.triangle,left:a.posAlign&&"right"==a.posAlign?KISSY.one(document).width()-g.left:a.pos&&"right"==a.pos?g.right:g.left,top:g.top,posAlign:a.posAlign||"left",id:id,text:a.text,"class":a.class+" "+(a.classflag||""),textHtml:a.textHtml||"",aftertext:a.aftertext||"",haitao_sbTip:a.haitao_sbTip||""},function(b,d){e(a,void 0!==d),KISSY.one("body").append(b),c()})}}}function e(b,c){var d;d=c?b.classflag&&a.all("."+b.classflag):a.one("#"+b.id),d&&d.remove()}if(b)for(var f=0,g=b.length;g>f;f++){var h=b[f];if(h.isOnlyOne&&"false"==h.isOnlyOne)for(var i=KISSY.all(h.query),j=0,k=i.length;k>j;j++){var l=KISSY.one(i[j]);d(h,l,j)}else{var l=KISSY.one(h.query);d(h,l)}}},helpTips:function(a){function b(a,b){if(a.condition&&b&&HaitaoUtils.isVisible(b)||!a.condition&&(!b||!HaitaoUtils.isVisible(b))){var c=KISSY.one(a.posquery)||b;if(c){var d=HaitaoUtils.getAbsolutePos(c,a.x,a.y);HaitaoUtils.generateTemplateHtml(window.Ali_Haitao.template.helpTips,{triangle:a.triangle,left:a.posAlign&&"right"==a.posAlign?KISSY.one(document).width()-d.left:d.left,top:d.top,id:a.id,expandDirection:a.expandDirection,posAlign:a.posAlign,html:a.html},function(a){KISSY.one("body").append(a)})}}}if(a)for(var c=0,d=a.length;d>c;c++){var e=a[c],f=KISSY.one("#"+e.id);f&&f.remove();var g=KISSY.one(e.query);b(e,g)}},getTransTimeStat:function(){localStorage.transTimeStat||(localStorage.transTimeStat=JSON.stringify(transTimeInitData));var a=JSON.parse(localStorage.transTimeStat),b="http://haiwai.etao.com/ajax/shenqi_time_stat.htm";e.get(b,function(b,c){if("success"==c){var d="object"==typeof b?b:JSON.parse(b);if(0==d.resultCode){var e=d.datas;if(e&&e.length>0){for(var f=0;f<e.length;f++){var g=e[f];a[g.company]={t2t1:g.t2t1,t3t2:g.t3t2,t4t3:g.t4t3,t4t1:g.t4t1}}localStorage.transTimeStat=JSON.stringify(a)}}}})},setPopupBadgeText:function(a){isNaN(a)&&(a=0),localStorage.hasShowAddrNotify="true";var b=localStorage.hasShowAddrNotify;b&&"true"==b||a++,a>0?(chrome.browserAction.setBadgeBackgroundColor({color:"#ff3c00"}),chrome.browserAction.setBadgeText({text:a.toString()})):chrome.browserAction.setBadgeText({text:""})},showGuide:function(){localStorage.getItem("aliHaitaoLoaded")||(localStorage.setItem("aliHaitaoLoaded","true"),chrome.tabs.create({url:"http://www.etao.com/go/rgn/haitao/amazonguide.php"}))},statistics:function(){var a=localStorage.haitao_isInstall,b=localStorage.haitao_mmstat_cna||"null";"null"==b?chrome.cookies.getAll({domain:".mmstat.com"},function(b){var c="null";if(b.length>0)for(var d=0;d<b.length;d++){var e=b[d];if("cna"==e.name){c=e.value;break}}localStorage.haitao_mmstat_cna=c,KISSY.Stat("cache=4504651&gmkey=etao_search&gokey=sfrom=etao&t=1369193914137&syn_show=haitao_addin:{{browser}}&cna="+c+"&isbeta=7&logtype=2",!0),a||(localStorage.haitao_isInstall=1,KISSY.Stat("cache=16f63b4&gmkey=etao_search&gokey=sfrom=etao&t=1369194202558&&cna="+c+"&isbeta=7&logtype=2&click=etao.etao_haitao_addin.{{browser}}.web.install.install_success",!0))}):(KISSY.Stat("cache=4504651&gmkey=etao_search&gokey=sfrom=etao&t=1369193914137&syn_show=haitao_addin:{{browser}}&cna="+b+"&isbeta=7&logtype=2",!0),a||(localStorage.haitao_isInstall=1,KISSY.Stat("cache=16f63b4&gmkey=etao_search&gokey=sfrom=etao&t=1369194202558&&cna="+b+"&isbeta=7&logtype=2&click=etao.etao_haitao_addin.{{browser}}.web.install.install_success",!0)))},initLoginStatus:function(){function b(){chrome.tabs.query({active:!0},function(b){a.each(b,function(a){chrome.tabs.sendMessage(a.id,{operate:"loginStatusChanged",data:JSON.parse(localStorage.haitao_login||null)},function(){})})})}HaitaoUtils.setLoginInfo(b),chrome.cookies.onChanged.addListener(function(a){"login"==a.cookie.name&&a.cookie.domain.indexOf("etao.com")>0&&HaitaoUtils.setLoginInfo(b)}),chrome.tabs.onActivated.addListener(function(){b()})},setLoginInfo:function(b){var c={login:"",tracknick:"",a_nk:"",_nk_:"",unb:"",l_t:"",_tb_token_:""};localStorage.haitao_login?c=JSON.parse(localStorage.haitao_login):localStorage.haitao_login=JSON.stringify(c),chrome.cookies.getAll({domain:".etao.com"},function(d){for(var e=0,f=d.length;f>e;e++){var g=d[e];a.isUndefined(c[g.name])||(c[g.name]=g.value)}(""==c.tracknick||""==c._nk_||""==c._tb_token_||""==c.a_nk||""==c.unb||"true"!=c.login)&&(c={login:"",tracknick:"",a_nk:"",_nk_:"",unb:"",l_t:"",_tb_token_:""},HaitaoUtils.setPopupBadgeText(0)),localStorage.haitao_login=JSON.stringify(c),b&&b()})},setLocalStorage:function(a){for(var b in a)localStorage[b]=a[b]},clipboardWrite:function(a,b,c,d){try{var e=document.createElement("div");e.contentEditable=!0,document.body.appendChild(e),e.innerHTML=a,e.unselectable="off",e.focus(),document.execCommand("SelectAll"),document.execCommand("Copy",!1,null),document.body.removeChild(e),d({})}catch(f){}},showAddrNotify:function(){},getConfig:function(){var a={isLoadRemoteRes:isLoadRemoteRes,template:HaitaoUtils.getTemplate(),login:localStorage.haitao_login||"null",config:localStorage.haitao_config||"null",mmstat_cna:localStorage.haitao_mmstat_cna||"null",isShowTips:localStorage.isShowTips?localStorage.isShowTips:"true",isTranslate:localStorage.isTranslate?localStorage.isTranslate:"true",isShowPushNotify:localStorage.isShowPushNotify?localStorage.isShowPushNotify:"true",transTimeStat:localStorage.transTimeStat?localStorage.transTimeStat:null};return a},loadTemplate:function(a){if(a.template)for(var b in a.template)HaitaoUtils.callAjax(b,a.template[b],a.extraUrl)},callAjax:function(a,b,c){isLoadRemoteRes?e.get(c+b,function(b){var c="object"==typeof b?JSON.stringify(b):b;localStorage["haitao_temp_"+a]=c}):e.get(chrome.extension.getURL(b),function(b){localStorage["haitao_temp_"+a]=b})},getTemplate:function(){var a={},b=JSON.parse(localStorage.haitao_config||null);if(b&&b.template)for(var c in b.template)a[c]=localStorage["haitao_temp_"+c];return a},getShipNameMap:function(){return JSON.parse(localStorage.haitao_temp_shippingName||"{}")},translate:function(a,b,c,d,f){var g="http://fanyi.youdao.com/paidapi/fanyiapi?key=10220261624kr1O8kVtB&type=data&doctype=json&q="+encodeURIComponent(a);e.get(g,function(a){var b={isError:1,top:200,left:200,title:"出错了",desc:[{text:"翻译失败，请稍后再试。"}]};if(0==a.errorCode)if(b.isError=0,b.desc=[],"translateInputCallback"==f){if(b.title=a.translation[0],b.desc.push({text:a.translation[0],key:a.query}),a.web)for(var d=a.web,e=0;e<d.length&&!(b.desc.length>=9);e++)for(var g=d[e].value,h=d[e].key,i=0;i<g.length;i++)g[i].toLowerCase()!=a.translation[0].toLowerCase()&&b.desc.push({text:g[i],key:h})}else if(a.basic){b.title=a.query+(a.basic.phonetic?" ["+a.basic.phonetic+"]":"");for(var g=a.basic.explains,i=0;i<g.length;i++)b.desc.push({text:g[i]})}else{b.title=a.query;for(var g=a.translation,i=0;i<g.length;i++)b.desc.push({text:g[i]})}chrome.tabs.sendMessage(c.tab.id,{operate:f||"translateCallback",data:b},function(){})})}}},{requires:["base","node","mu","io","stat","listenCssChange"]});