/*! 2014-12-19 11:12:26 */
KISSY.add("hoverGetWord",function(a,b,c){function d(a){var b=this;d.superclass.constructor.call(b,a),b._init()}var e=null,f=3;return a.extend(d,c,{_init:function(){var a=this;KISSY.one(document).on("click",function(b){var c=KISSY.one(b.target);if(c.hasClass("haitao_btn_close")||c.parent(".haitao_btn_close"))a.closeTranslate();else{if(c.hasClass("haitao_trans_tips")||c.parent(".haitao_trans_tips"))return;a.closeTranslate()}}),KISSY.one(document).on("mousemove",function(b){a.closeTranslate(),clearTimeout(e);var c=KISSY.one(b.target).parent(".haitao_font");"true"!=window.Ali_Haitao.isTranslate||c||(window.Ali_Haitao.cursorX=b.pageX,window.Ali_Haitao.cursorY=b.pageY,a._callTranslate())})},_callTranslate:function(){var b=this;e=setTimeout(function(){var c=KISSY.one(window),d=b.getWordAtPoint(a.one("body").getDOMNode(),window.Ali_Haitao.cursorX-c.scrollLeft(),window.Ali_Haitao.cursorY-c.scrollTop());d&&""!=d.trim()&&HaitaoUtils.getMessageFromBackground({operate:"translate",data:d},function(){})},b.get("duration"))},closeTranslate:function(){var a=KISSY.all(".haitao_trans_tips");a&&a.remove()},getWordAtPoint:function(a,b,c){if(a){var d=this,e=0,g=0,h=null;if(a.nodeType===f)h=d._getWord(a,b,c);else for(g=a.childNodes.length,e=0;g>e;e++)d._tagFilter(a.childNodes[e].nodeName,["SCRIPT","STYLE"])&&(h=h||d.getWordAtPoint(a.childNodes[e],b,c));return h}},_tagFilter:function(a,b){var c=0,d=b.length;for(c=0;d>c;c++)if(b[c]===a)return!1;return!0},_getWord:function(a,b,c){var d=a.ownerDocument.createRange();d.selectNodeContents(a);for(var e=0,f=0,g=null,h=d.toString(),i=(h.length,0),j=null;j=h.match(/\b\S+\b/);){if(i=h.search(/\b\S+\b/),e=f+i,f=e+j[0].length,d.setStart(d.startContainer,e),d.setEnd(d.startContainer,f),g=d.getBoundingClientRect(),g.left<=b&&g.right>=b&&g.top<=c&&g.bottom>=c)return j[0];h=h.slice(i+j[0].length)}return null}},{ATTRS:{name:{value:"HoverGetWord"},duration:{value:1e3}}}),d},{requires:["node","base"]});