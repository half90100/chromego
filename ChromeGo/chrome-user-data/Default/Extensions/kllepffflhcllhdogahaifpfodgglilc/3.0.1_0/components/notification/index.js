/*! 2014-12-19 11:12:26 */
var notification={sender:null,baseStat:"cache=16f63b4&gmkey=etao_search&gokey=sfrom=etao&t=1369194202558&&cna="+(localStorage.haitao_mmstat_cna||"null")+"&isbeta=7&logtype=2&click=etao.etao_haitao_addin.{{browser}}.",init:function(){chrome.notifications.onButtonClicked.addListener(function(a,b){if("notify_addrUpdate"==a)0==b?chrome.tabs.create({url:"http://wanke.etao.com/detail/342227.html"}):1==b&&notification.sender&&chrome.tabs.sendMessage(notification.sender.tab.id,{operate:"neverRemindAddrNotify",data:""},function(){});else if(0==b){var c="http://8.etao.com/yitaohaitao/thread-2688308-714371644-0-1-detail.htm#reply5243131533";localStorage[a]&&(c=localStorage[a]),chrome.tabs.create({url:c})}else if(1==b){var c="http://8.etao.com/yitaohaitao/thread-2688308-710452177-0-1-datail.htm?r=n";localStorage[a]&&(c=localStorage[a]),chrome.tabs.create({url:c})}notification.sender=null,chrome.notifications.clear(a,function(){})}),chrome.tabs.onActivated.addListener(function(){notification.showReminder()}),setTimeout(function(){notification.websiteActivityInit(),notification.pushNotifyInit()},3e5)},reminderData:[],create:function(a,b,c,d,e,f){var g={type:"basic",priority:2,title:b||"欢迎使用海淘神器",message:c||"用海淘神器下单，可独享转运费优惠价！让您像淘宝一样简单海淘！",buttons:e,iconUrl:f||"images/icon128_1.png"};chrome.notifications.create(a||"ali_haitao",g,function(){}),chrome.notifications.onClicked.addListener(function(b){b==a&&(d(),chrome.notifications.clear(b,function(){}))})},submitOrder:function(a){var b={asos:!0,iherb:!0,"net-a-porter":!0};b[a.name]?notification.directReminder(a.name):notification.noDirectReminder(a.name),notification.addToReminder()},noDirectReminder:function(a){notification.create("notify_noDirect","下单成功后，您需要做：",(a||"")+"发货后，您可以在海淘神器“我的运单”中进行物流追踪。神器也会随时提醒您进行包裹的后续处理。",function(){chrome.tabs.create({url:"http://8.etao.com/yitaohaitao/thread-2688308-714371644-0-1-detail.htm"})},[{title:"如何进行物流追踪？"},{title:"海淘神器问题反馈。"}])},directReminder:function(a){notification.create("notify_direct","下单成功后，您需要做：",(a||"")+"发货后，您可以在订单详情里查看到物流信息。直邮网站的货物会直接送到中国国内，无需其他操作。",function(){},[{title:"如何进行物流追踪？"},{title:"海淘神器问题反馈。"}])},twoDaysReminder:function(){notification.create("notify_operate","亲，之前在海淘的商品发货了吗？","商家发货后，您可以在海淘神器“我的运单”中进行物流追踪。神器也会随时提醒您进行包裹的后续处理。",function(){chrome.tabs.create({url:"http://8.etao.com/yitaohaitao/thread-2688308-714371644-0-1-detail.htm"})},[{title:"如何进行物流追踪？"},{title:"海淘神器问题反馈。"}])},addrUpdateReminder:function(){localStorage.haitao_notify_addrUpdate_showned||(notification.create("notify_addrUpdate","海淘神器转运地址获取方式变更通知","亲爱的神器用户，为了提供更好的转运服务，我们新增了一家海淘客（12日必达），同时原来4家转运地址获取方式发生变化，点击查看详情。",function(){chrome.tabs.create({url:"http://wanke.etao.com/detail/342227.html"})}),localStorage.haitao_notify_addrUpdate_showned=!0)},addToReminder:function(){var a=new Date,b=new Date(a.getFullYear(),a.getMonth(),a.getDate());notification.reminderData[0]!=b&&(notification.reminderData.unshift(b.getTime()),notification.setReminderData())},setReminderData:function(){localStorage.ali_reminder=JSON.stringify(notification.reminderData)},getReminderData:function(){notification.reminderData=JSON.parse(localStorage.ali_reminder||"[]").sort().reverse()},getZeroTime:function(a){var b=a?new Date(a):new Date,c=new Date(b.getFullYear(),b.getMonth(),b.getDate());return c.getTime()},showReminder:function(){notification.getReminderData();for(var a=notification.getZeroTime()-1728e5,b=notification.getZeroTime()-1296e6,c=0;c<notification.reminderData.length;c++){var d=notification.reminderData[c];if(a>d){notification.reminderData=notification.reminderData.splice(0,c),d>b&&notification.twoDaysReminder();break}}notification.setReminderData()},websiteActivityInit:function(){notification.websiteActivity(),setInterval(function(){notification.websiteActivity()},864e5)},websiteActivity:function(){localStorage.haitao_huodong_notify_0=1;var a="http://www.etao.com/go/rgn/haitao_shenqi_notify.php";KISSY.use("io, stat",function(b,c){c.get(a,function(a,b){if("success"==b){var c="object"==typeof a?a:JSON.parse(a),d=c.huodongNum||0;localStorage["haitao_huodong_notify_"+d]||(notification.create("notify_haitao_activity",c.title,c.desc,function(){chrome.tabs.create({url:c.link}),KISSY.Stat(notification.baseStat+"web.pop.pop_click",!0)},null,c.image),KISSY.Stat(notification.baseStat+"web.pop.pop_open",!0),localStorage["haitao_huodong_notify_"+d]=1)}})})},pushNotifyInit:function(){notification.pushNotify(),setInterval(function(){notification.pushNotify()},3e5)},pushNotify:function(){if(!localStorage.isShowPushNotify||"false"!=localStorage.isShowPushNotify){var a="http://www.etao.com/api/get-haitao-jsonp.html";KISSY.use("io, stat",function(b,c){c.getJSON(a,function(a,b){if("success"==b)for(var c="object"==typeof a?a:JSON.parse(a),d=0;d<c.length;d++){var e=c[d];if(e.tag&&-1!=e.tag.indexOf("跳楼价")&&!localStorage["notify_haitao_pushNotify"+e.feedId]){var f=new Date-new Date(e.onlineTime);if(f/36e5>24)continue;localStorage["notify_haitao_pushNotify"+e.feedId]=e.link,notification.create("notify_haitao_pushNotify"+e.feedId,e.title,e.context.substring(0,50)+"...",function(){chrome.tabs.create({url:e.link}),KISSY.Stat(notification.baseStat+"web.pop.pop_click",!0)},null,e.tfsPic),KISSY.Stat(notification.baseStat+"web.pop.pop_open",!0);break}}})})}}};