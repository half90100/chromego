/*! 2014-12-19 11:12:26 */
window.haitaoLogin={LoginPopupHtml:'<div class="login-popup" id="J_LoginPopup" login-stat="etao.etao_fc.zfb_member"><h2>立即登陆</h2><span class="close-login-btn J_CloseLoginBtn" title="关闭">关闭</span><ul class="login-type"  id="J_LoginType"><li><a hidefocus="true" id="J_TaobaoMember" class="current" login-stat="etao.etao_fc.tb_member" href="#J_TaobaoMember">淘宝会员</a></li><li><a hidefocus="true"  id="J_AlipayMember" login-stat="etao.etao_fc.zfb_member" href="#J_AlipayMember">支付宝会员</a></li></ul><a href="http://wanke.etao.com/detail/497532.html" target="_blank" class="tip haitao_hidden">如果密码输入框是灰色?</a><script>(function() {var redirect_url = \'\';'+"var taobaoIframeSrc = 'https://login.taobao.com/member/login.jhtml?style=miniall&css_style=etao&full_redirect=false&default_long_login=1&from=etao&tpl_redirect_url=' + encodeURIComponent('http://login.etao.com//loginmid.html?redirect_url=' + encodeURIComponent(redirect_url));var target = 'https://login.taobao.com/member/alipay_sign_dispatcher.jhtml?tg=' + encodeURIComponent('http://login.etao.com//loginmid.html?login_type=alipay&redirect_url=' + encodeURIComponent(redirect_url));var alipayIframeSrc = 'http://login.etao.com/alipaypopup.html?goto=' + encodeURIComponent('https://auth.alipay.com/login/taobao_trust_login.htm?target=' + encodeURIComponent(target));var iframe = document.createElement('iframe');iframe.setAttribute('scrolling', 'no');iframe.setAttribute('frameBorder', '0');iframe.setAttribute('allowTransparency', 'true');iframe.setAttribute('border', '0');iframe.style.overflow = 'hidden';iframe.width = '342';iframe.height = '500';iframe.src = taobaoIframeSrc;var loginpopup = document.getElementById('J_LoginPopup');loginpopup.appendChild(iframe);var S = KISSY, D = KISSY.DOM, E = S.Event, loginTypes = S.query('#J_LoginType a');if (!loginTypes.length) return;KISSY.ChangeIframeSrc = function (redirect_url, type) {redirect_url = redirect_url;var taobaoNode = S.one('#J_TaobaoMember'),alipayNode = S.one('#J_AlipayMember');if (type == 'taobao') {iframe.src = taobaoIframeSrc;if (!taobaoNode.hasClass('current')) {taobaoNode.addClass('current');}if (alipayNode.hasClass('current')) {alipayNode.removeClass('current');}} else {iframe.src = alipayIframeSrc;if (taobaoNode.hasClass('current')) {taobaoNode.removeClass('current');}if (!alipayNode.hasClass('current')) {alipayNode.addClass('current');}}};E.on(loginTypes, 'click', function(e) {e.preventDefault();S.each(loginTypes, function(logintype) {D.removeClass(logintype, 'current');});D.addClass(this, 'current');if (this.id == 'J_TaobaoMember') {iframe.src = taobaoIframeSrc;} else {iframe.src = alipayIframeSrc;}});})();</script></div>",cookieNames:["login","tracknick","a_nk","_nk_","l_t"],login:function(){KISSY.use("LoginPopup",function(a,b){KISSY.one("body").height(480);var c=new b;c.init({full_redirect:!1,isRedirectToA:!1}),c.showLoginPopup(),a.UA.chrome&&a.UA.chrome>=33&&a.one("#J_LoginPopup a.tip").removeClass("haitao_hidden")})},clearCookie:function(){for(var a=0;a<window.haitaoLogin.cookieNames;a++){var b=window.haitaoLogin.cookieNames[a];chrome.cookies.set({url:"http://www.etao.com",name:b,value:""}),chrome.cookies.set({url:"http://www.taobao.com",name:b,value:""})}},cookieObj:{},init:function(){window.haitaoLogin.initLoginHtml(),chrome.cookies&&chrome.cookies.onChanged.addListener(function(a){if(("login"==a.cookie.name||"tracknick"==a.cookie.name||"a_nk"==a.cookie.name||"_nk_"==a.cookie.name)&&a.cookie.domain.indexOf("etao.com")>0){if(window.haitaoLogin.cookieObj[a.cookie.name]==a.cookie.value)return;window.haitaoLogin.cookieObj[a.cookie.name]=a.cookie.value,window.haitaoLogin.checkIsLogin(window.haitaoLogin.initLoginHtml)}})},loginStatusTimout:null,initLoginHtml:function(){window.haitaoLogin.loginStatusTimout||(window.haitaoLogin.loginStatusTimout=setTimeout(function(){KISSY.one("body").fire("loginStatusUpdate"),window.haitaoLogin.loginStatusTimout=null},100))},checkIsLogin:function(a){var b={login:"",tracknick:"",a_nk:"",_nk_:"",l_t:""};localStorage.haitao_login?b=JSON.parse(localStorage.haitao_login):localStorage.haitao_login=JSON.stringify(b),chrome.cookies.getAll({domain:".etao.com"},function(c){if(c.length>0)for(var d=0;d<c.length;d++){var e=c[d];"login"!=e.name&&"tracknick"!=e.name&&"_nk_"!=e.name&&"a_nk"!=e.name&&"l_t"!=e.name||(b[e.name]=e.value)}""!=b.tracknick&&(b._nk_||b.a_nk)&&"true"==b.login&&(localStorage.haitao_login=JSON.stringify(b)),a&&a()})},logout:function(){localStorage.removeItem("haitao_login");var a='<iframe id="haitao_logout_iframe" scrolling="no" frameborder="0" allowtransparency="true" border="0" width="0" height="0" src="http://login.etao.com/logout.html?spm=1002.1.1.2.WKDeiY&" style="overflow: hidden;"></iframe>';KISSY.one("body").append(a),KISSY.one("body").fire("loginStatusUpdate")}},KISSY.add("LoginPopup",function(a,b,c,d){function e(a){var b=this;e.superclass.constructor.call(b,a),b.init()}if(top!==self&&top.ETao&&!top.ETao.needRefresh)try{var f=top.ETao.loginSuccess;f&&f(),top.ETao.Header&&new top.ETao.Header}catch(g){}var h=a.DOM,i=a.Event;return e.timestamp=131013,a.extend(e,d,{init:function(){var a=this;KISSY.one(a.get("el")).delegate(a.get("triggerType"),a.get("trigger"),function(b){var c=a.get("redirect_url"),d=a.get("needRefresh");if(!(a.checkTrueLogin()||a.get("isCheckLongOrTrueLogin")&&a.checkLongOrTrueLogin())){b.preventDefault();var e=a.get("isRedirectToA")?b.currentTarget.href:c;a.show({redirect_url:e,needRefresh:d})}})},destructor:function(){},checkTrueLogin:function(){var a="true"==b.get("login"),c=b.get("_nk_"),d=b.get("a_nk");return a&&(c||d)},checkLongOrTrueLogin:function(){var a=this,c=b.get("tracknick"),d=b.get("ck1")||b.get("lgc");return a.checkTrueLogin()||c&&d},showLoginPopup:function(a){var b=this;b.show(a)},show:function(){var b=this,d=b.get("loginType"),e=b.get("redirect_url"),f=(b.get("needRefresh"),"&pre="+escape(window.location.href));if(b.login){var g=h.viewportHeight()/2-200+h.scrollTop(),j=h.viewportWidth()/2-171+h.scrollLeft();h.css(b.login.get("el")[0],{top:0>g?0:g,left:0>j?0:j}),b.login.show(),a.Stat&&a.Stat("click="+h.attr("#J_LoginPopup","login-stat")+f)}else if(window.loginFormPopup){var k=window.loginFormPopup;KISSY.ChangeIframeSrc(e,d);var g=h.viewportHeight()/2-200+h.scrollTop(),j=h.viewportWidth()/2-171+h.scrollLeft();h.css(k.get("el")[0],{top:0>g?0:g,left:0>j?0:j}),k.show(),a.Stat&&a.Stat("click="+h.attr("#J_LoginPopup","login-stat")+f)}else{var l=new c({prefixCls:"etaologin-",width:342,height:500,mask:b.get("mask"),zIndex:10001});l.render(),l.get("contentEl").html(window.haitaoLogin.LoginPopupHtml,!0);var g=h.viewportHeight()/2-200+h.scrollTop(),j=h.viewportWidth()/2-171+h.scrollLeft();h.css(l.get("el")[0],{top:0>g?0:g,left:0>j?0:j}),l.show(),window.loginFormPopup=l,b.login=l;var m=a.guid();b.id=m,l.get("el")[0].id=m,i.on(".J_CloseLoginBtn","click",function(){l.hide(),h.css(".etaologin-overlay",{top:"-9999px"})}),a.Stat&&a.Stat("click="+h.attr("#J_LoginPopup","login-stat")+f),i.delegate("#"+m,"click","li a",function(b){b.preventDefault();var c=b.currentTarget;a.Stat&&(a.Stat("click="+h.attr("#J_LoginPopup","login-stat")+f),a.Stat("J_TaobaoMember"===c.id?"click="+h.attr("#J_TaobaoMember","login-stat")+f:"click="+h.attr("#J_AlipayMember","login-stat")+f))})}},hide:function(){this.login.hide()}},{ATTRS:{el:{value:"body"},trigger:{value:".J_EtaoLogin"},triggerType:{value:"click"},redirect_url:{value:window.location.href},loginType:{value:"taobao"},isRedirectToA:{value:!1},isCheckLongOrTrueLogin:{value:!0},needRefresh:{value:!0},mask:{value:!0}}}),e},{requires:["cookie","overlay","base"]});